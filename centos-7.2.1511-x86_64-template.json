{
    "variables": {
        "build_number": "{{timestamp}}",
        "centos_version": "7.2.1511",
        "iso_url": "http://mirror.steadfast.net/centos/7/isos/x86_64/CentOS-7-x86_64-NetInstall-1511.iso",
        "iso_checksum": "9ed9ffb5d89ab8cca834afce354daa70a21dcb410f58287d6316259ff89758f5",
        "iso_checksum_type": "sha256",
        "root_hash": "*LOCKED*",
        "ssh_timeout": "90m",
        "sssd_conf": "files/emptyfile",
        "tmpdir": "/tmp",
        "vm_cpu": "1",
        "vm_mem": "2048"
    },

    "builders": [
        {
            "boot_command": [
                "<esc>",
                "<wait>linux ks=http://{{.HTTPIP}}:{{.HTTPPort}}/ks-updates.cfg<enter>"
            ],
            "boot_wait": "5s",
            "disk_size": 6000,
            "format": "ova",
            "guest_additions_mode": "disable",
            "guest_os_type": "RedHat_64",
            "http_directory": "./http",
            "iso_checksum": "{{user `iso_checksum`}}",
            "iso_checksum_type": "{{user `iso_checksum_type`}}",
            "iso_url": "{{user `iso_url`}}",
            "name": "base",
            "output_directory": "output_packer",
            "ssh_password": "root",
            "ssh_timeout": "{{user `ssh_timeout`}}",
            "ssh_username": "root",
            "shutdown_command": "shutdown -h now",
            "type": "virtualbox-iso",
            "vboxmanage": [
                [ "modifyvm", "{{.Name}}", "--memory", "{{user `vm_mem`}}" ],
                [ "modifyvm", "{{.Name}}", "--cpus",   "{{user `vm_cpu`}}" ],
                [ "modifyvm", "{{.Name}}", "--paravirtprovider",   "kvm" ],
                [ "modifyvm", "{{.Name}}", "--nic1",   "nat" ],
                [ "modifyvm", "{{.Name}}", "--nictype1",   "virtio" ],
                [ "modifyvm", "{{.Name}}", "--vram",   "64" ],
                [ "modifyvm", "{{.Name}}", "--hwvirtex",   "on" ],
                [ "modifyvm", "{{.Name}}", "--nestedpaging",   "on" ],
                [ "modifyvm", "{{.Name}}", "--largepages",   "on" ],
                [ "modifyvm", "{{.Name}}", "--vtxvpid",   "on" ],
                [ "modifyvm", "{{.Name}}", "--vtxux",   "on" ],
                [ "modifyvm", "{{.Name}}", "--biospxedebug",   "on" ]
            ],
            "vm_name": "centos-{{user `centos_version`}}-x86_64-{{user `build_number`}}"
        }
    ],

    "provisioners": [
       {
           "type": "file",
           "source": "files/ansible-profile.sh",
           "destination": "/tmp/ansible-profile.sh"
       },
       {
           "only": [ "base" ],
           "type": "shell",
           "scripts": [
               "scripts/console.sh",
               "scripts/disable-rhgb.sh",

               "scripts/git.sh",
               "scripts/gcc.sh",
               "scripts/net-tools.sh",
               "scripts/htop.sh",
               "scripts/emacs-nox.sh",
               "scripts/tree.sh",
               "scripts/patch.sh",
               "scripts/libffi.sh",
               "scripts/python-pip.sh",

               "scripts/ansible.sh",
               "scripts/ansible-deploys.sh",
               "scripts/ansible-profile.sh",

               "scripts/rhel-bug-1212883.sh",
               "scripts/dracut-growpart.sh",
               "scripts/cloud-init.sh",

               "scripts/avahi-daemon.sh",
               "scripts/kdump.sh",

               "scripts/lock-root.sh",
               "scripts/cleanup.sh"
       }
    ]
}
